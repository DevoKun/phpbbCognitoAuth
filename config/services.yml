
services:
    mrfg.cogauth.listener:
        class: mrfg\cogauth\event\main_listener
        arguments:
            - '@user'
            - '@mrfg.cogauth.cognito'
            - '@dispatcher'
        tags:
            - { name: event.listener }

    mrfg.cogauth.cognito_client_wrapper:
        class: mrfg\cogauth\cognito\cognito_client_wrapper

    mrfg.cogauth.web_token_phpbb:
        class: mrfg\cogauth\cognito\web_token_phpbb
        arguments:
            - '@config'
            - '@cache.driver'
            - '%mrfg.cogauth.jwsk_url_template%'

    mrfg.cogauth.authentication:
        class: mrfg\cogauth\cognito\authentication
        arguments:
            - '@mrfg.cogauth.web_token_phpbb'
            - '@dbal.conn'
            - '%mrfg.cogauth.tables.cogauth_authentication%'

    mrfg.cogauth.cognito:
        class: mrfg\cogauth\cognito\cognito
        arguments:
            - '@dbal.conn'
            - '@config'
            - '@user'
            - '@request'
            - '@log'
            - '@mrfg.cogauth.cognito_client_wrapper'
            - '@mrfg.cogauth.web_token_phpbb'
            - '%mrfg.cogauth.tables.cogauth_session%'

    mrfg.cogauth.access_token_cleanup:
        class: mrfg\cogauth\cron\task\access_token_cleanup
        arguments:
            - '@config'
            - '@dbal.conn'
            - '@mrfg.cogauth.cognito'
        calls:
            - [set_name, [cogauth.cron.access_token_cleanup]]
        tags:
            - { name: cron.task }

    mrfg.cogauth.controller:
        class: mrfg\cogauth\controller\main
        arguments:
            - '@config'
            - '@request'
            - '@mrfg.cogauth.cognito'
            - '@mrfg.cogauth.web_token_phpbb'
            - '@language'

imports:
- { resource: auth.yml }
- { resource: tables.yml }
- { resource: parameters.yml }
